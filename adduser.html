<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Добавить пользователя</title>
  <style>
    html{color-scheme: dark}
    body{font-family: sans-serif; padding: 0 1.5rem 1.5rem; margin: 0; background-color: #222222; color: #fff;}
    input{border: 1px solid #dde5f6; border-radius: 10px; background: #fff; padding: 0.5rem; color: #000}
    button{margin-top: 15px; width: 100%; padding: 8px;}
    #divForm{display: flex; flex-direction: column; gap: 0.5rem; background-color: #1648B8; border: 1px solid rgb(10, 88, 202); padding: 1rem; border-radius: 1rem}
    button{border: none; background-color: rgb(220, 57, 177); color: #fff; padding: 0.7rem; cursor: pointer; font-size: 1rem; border-radius: 0.5rem; margin: 0.5rem 0}
    button:hover{background-color: #1648B8}
    select {width: 100%; padding: 6px 8px; margin-top: 4px; font-size: 14px; border-radius: 4px; border: 1px solid #ccc;}
    select:hover {border-color: #0078d7}
  </style>
</head>
<body>
  <h2>Добавить пользователя</h2>
  <div id="status" style="margin-bottom: 0.5rem"></div>
  <form id="userForm">
    <div id="divForm">
    <h6 style="color: rgb(255, 36, 36); text-align: end; margin: 0;">* - обязательное поле</h6>
    <label>Шаблон:
      <select id="templateSelect">
        <option value="">— Без шаблона —</option>
        <option value="flightAttendant">Бортпроводник</option>
      </select>
    </label>
    <label>Имя<span style="color: rgb(255, 36, 36);">*</span> </label>
    <input name="FirstName" placeholder="Регистр не важен" required>
    <label>Фамилия<span style="color: rgb(255, 36, 36);">*</span> </label>
    <input name="LastName" placeholder="Регистр не важен" required>
    <label>Отчество </label>
    <input name="MiddleName" placeholder="Регистр не важен">
    <label>Username (оставьте пустым для автогенерации) </label>
    <input name="Username" placeholder="Можно указать вручную">
    <label>Отдел<span style="color: rgb(255, 36, 36);">*</span> </label >
    <input name="Department" placeholder="Регистр не важен" required>
    <label>Должность<span style="color: rgb(255, 36, 36);">*</span> </label>
    <input name="Title" placeholder="Регистр не важен" required>
    <label>Телефон </label>
    <input name="Phone">
    <h5 style="margin: 0.5rem 0;">Для авто-добавления в группы AD </h5>
    <label>Группа 1 </label>
    <input name="Group1">
    <label>Группа 2 </label>
    <input name="Group2">
    <label>Группа 3 </label>
    <input name="Group3">
    </div>
    <button type="submit">Сохранить</button>
  </form>

  <script>
    const form = document.getElementById('userForm');
    const statusDiv = document.getElementById('status');
    let currentCSV = null;

    const templateSelect = document.getElementById('templateSelect');

    const templates = {
      flightAttendant: {
        Department: "Flight Attendant Service",
        Title: "Flight Attendant",
        Phone: "",
        Group1: "AIR.TAS.FS.Projects.GDrive.Common.CabinO.RO",
        Group2: "Flight Attendant Service-1-1086862266",
        Group3: "AIR.TAS.TrolleyUsers"
      }
    };

    const getField = name => form.querySelector(`[name="${name}"]`);

    templateSelect.addEventListener('change', () => {
      const selected = templateSelect.value;
      if (!selected || !templates[selected]) return;
      const t = templates[selected];

      getField('Department').value = t.Department;
      getField('Title').value = t.Title;
      getField('Phone').value = t.Phone;
      getField('Group1').value = t.Group1;
      getField('Group2').value = t.Group2;
      getField('Group3').value = t.Group3;
    });

    window.api.onUserInit(csvPath => {
      currentCSV = csvPath;
      if (csvPath) statusDiv.textContent = "Текущий файл: " + csvPath;
      else statusDiv.textContent = "Создаётся новый CSV...";
    });

    form.onsubmit = e => {
      e.preventDefault();
      const formData = new FormData(form);
      const user = Object.fromEntries(formData.entries());
      window.api.saveUser({ csvPath: currentCSV, user });
    };

    window.api.onUserSaved(res => {
      if (res.ok) {
        statusDiv.textContent = "✅ Пользователь добавлен";
        if (res.newPath) currentCSV = res.newPath;
      } else {
        statusDiv.textContent = "❌ Ошибка: " + res.error;
      }
    });
  </script>
</body>
</html>
